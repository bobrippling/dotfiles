#!/bin/sh

# This works only when in the same shell as the terminal
# aka
# % . $0

#sudo -k # revoke

if test "$SHLVL" -le 1
then
	if tty | grep 'tty' >/dev/null
	then clear
	fi

	if test -z "$DISPLAY"
	then
		if pgrep -x gpg-agent >/dev/null
		then
			echo "$0: clearing gpg-agent" >&2
			echo "reloadagent" | gpg-connect-agent >/dev/null
		fi
		echo "$0: clearing ssh-agent" >&2
		ssh-add -Dq
	else
		echo "$0: not clearing ssh/gpg-agent: \$DISPLAY set" >&2
	fi
fi
